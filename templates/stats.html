{% extends "base.html" %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-gray-50 via-blue-50 to-indigo-50">
  <!-- Header -->
  <div class="bg-white shadow-lg border-b-4 border-blue-500">
    <div class="max-w-7xl mx-auto px-6 py-6">
      <div class="flex items-center justify-between">
        <div>
          <h1 class="text-3xl font-bold text-gray-900 mb-2">ğŸ“Š Analisis Hasil Kuisioner</h1>
          <p class="text-lg text-gray-600">{{ kuisioner.title }}</p>
          {% if kuisioner.description %}
          <p class="text-sm text-gray-500 mt-1">{{ kuisioner.description }}</p>
          {% endif %}
        </div>
        <div class="flex space-x-3">
          <a href="/kuisioner/{{ kuisioner.id }}/export"
             class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-semibold shadow-lg transition-all transform hover:scale-105 flex items-center space-x-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
            </svg>
            <span>Export CSV</span>
          </a>
          <a href="/dashboard"
             class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg font-semibold shadow-lg transition-all transform hover:scale-105 flex items-center space-x-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
            </svg>
            <span>Kembali</span>
          </a>
        </div>
      </div>
    </div>
  </div>

  <div class="max-w-7xl mx-auto px-6 py-8">
    <!-- Statistics Dashboard -->
    {% if text_stats and 'error' not in text_stats %}
    <div class="mb-8">
      <img src="{{ stats_dashboard }}" alt="Dashboard Statistik" class="w-full rounded-2xl shadow-2xl border-4 border-white">
    </div>
    {% endif %}

    <!-- Main Visualizations Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
      <!-- Bar Chart -->
      <div class="bg-white rounded-2xl shadow-xl p-6 border border-gray-100 hover:shadow-2xl transition-shadow">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-xl font-bold text-gray-800 flex items-center">
            <span class="text-3xl mr-3">ğŸ“Š</span>
            Distribusi Jawaban
          </h3>
        </div>
        <img src="{{ chart }}" alt="Chart" class="w-full rounded-lg">
      </div>

      <!-- Pie Chart -->
      <div class="bg-white rounded-2xl shadow-xl p-6 border border-gray-100 hover:shadow-2xl transition-shadow">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-xl font-bold text-gray-800 flex items-center">
            <span class="text-3xl mr-3">ğŸ©</span>
            Proporsi Jawaban
          </h3>
        </div>
        <img src="{{ pie }}" alt="Pie Chart" class="w-full rounded-lg">
      </div>
    </div>

    <!-- Sentiment Analysis -->
    <div class="mb-8 bg-white rounded-2xl shadow-xl p-6 border border-gray-100 hover:shadow-2xl transition-shadow">
      <h3 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
        <span class="text-3xl mr-3">ğŸ˜Š</span>
        Analisis Sentimen
      </h3>
      <img src="{{ sentiment_chart }}" alt="Sentiment Analysis" class="w-full rounded-lg">
    </div>

    <!-- Word Frequency and Response Length -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
      <!-- Word Frequency -->
      <div class="bg-white rounded-2xl shadow-xl p-6 border border-gray-100 hover:shadow-2xl transition-shadow">
        <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
          <span class="text-3xl mr-3">ğŸ“</span>
          Kata Paling Sering
        </h3>
        <img src="{{ word_freq }}" alt="Word Frequency" class="w-full rounded-lg">
      </div>

      <!-- Response Length -->
      <div class="bg-white rounded-2xl shadow-xl p-6 border border-gray-100 hover:shadow-2xl transition-shadow">
        <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
          <span class="text-3xl mr-3">ğŸ“</span>
          Panjang Jawaban
        </h3>
        <img src="{{ response_length }}" alt="Response Length" class="w-full rounded-lg">
      </div>
    </div>

    <!-- Word Cloud -->
    <div class="mb-8 bg-white rounded-2xl shadow-xl p-6 border border-gray-100 hover:shadow-2xl transition-shadow">
      <h3 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
        <span class="text-3xl mr-3">â˜ï¸</span>
        Word Cloud - Kata Populer
      </h3>
      <img src="{{ wc }}" alt="Word Cloud" class="w-full rounded-lg">
    </div>

    <!-- Keyword Analysis -->
    <div class="mb-8 bg-white rounded-2xl shadow-xl p-6 border border-gray-100 hover:shadow-2xl transition-shadow">
      <h3 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
        <span class="text-3xl mr-3">ğŸ”‘</span>
        Kata Kunci Penting (TF-IDF)
      </h3>
      <img src="{{ keyword_chart }}" alt="Keywords" class="w-full rounded-lg">
    </div>

    <!-- Top Contributors -->
    <div class="mb-8 bg-white rounded-2xl shadow-xl p-6 border border-gray-100 hover:shadow-2xl transition-shadow">
      <h3 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
        <span class="text-3xl mr-3">ğŸ‘¥</span>
        Kontributor Teratas
      </h3>
      <img src="{{ top_contributors }}" alt="Top Contributors" class="w-full rounded-lg">
    </div>

    <!-- LDA Topics -->
    {% if topics and 'error' not in topics %}
    <div class="mb-8 bg-white rounded-2xl shadow-xl p-6 border border-gray-100 hover:shadow-2xl transition-shadow">
      <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
        <span class="text-3xl mr-3">ğŸ§ </span>
        Topic Modeling (LDA) - {{ topics.n_responses }} Respons
      </h3>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        {% for topic in topics.topics %}
        <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6 border-2 border-blue-200 hover:shadow-lg transition-all transform hover:scale-105">
          <h4 class="text-lg font-bold text-blue-900 mb-4 flex items-center">
            <span class="bg-blue-500 text-white rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm">{{ topic.topic_id }}</span>
            Topic {{ topic.topic_id }}
          </h4>
          <div class="space-y-2">
            {% for word in topic.words %}
            <div class="bg-white rounded-lg px-4 py-2 shadow-sm border border-blue-100">
              <span class="text-gray-800 font-medium">{{ word }}</span>
            </div>
            {% endfor %}
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    <!-- Text Analytics Summary -->
    {% if text_stats and 'error' not in text_stats %}
    <div class="mb-8 bg-gradient-to-r from-purple-500 to-indigo-600 rounded-2xl shadow-2xl p-8 text-white">
      <h3 class="text-2xl font-bold mb-6 flex items-center">
        <span class="text-4xl mr-3">ğŸ“ˆ</span>
        Ringkasan Statistik
      </h3>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
        <div class="bg-white bg-opacity-20 rounded-xl p-6 backdrop-blur-sm border border-white border-opacity-30">
          <div class="text-4xl font-bold mb-2">{{ text_stats.total_responses }}</div>
          <div class="text-sm font-medium opacity-90">Total Respons</div>
        </div>
        <div class="bg-white bg-opacity-20 rounded-xl p-6 backdrop-blur-sm border border-white border-opacity-30">
          <div class="text-4xl font-bold mb-2">{{ text_stats.avg_words }}</div>
          <div class="text-sm font-medium opacity-90">Rata-rata Kata</div>
        </div>
        <div class="bg-white bg-opacity-20 rounded-xl p-6 backdrop-blur-sm border border-white border-opacity-30">
          <div class="text-4xl font-bold mb-2">{{ text_stats.total_words }}</div>
          <div class="text-sm font-medium opacity-90">Total Kata</div>
        </div>
        <div class="bg-white bg-opacity-20 rounded-xl p-6 backdrop-blur-sm border border-white border-opacity-30">
          <div class="text-4xl font-bold mb-2">{{ text_stats.avg_chars|int }}</div>
          <div class="text-sm font-medium opacity-90">Rata-rata Karakter</div>
        </div>
      </div>
      <div class="mt-6 grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
        <div class="text-center">
          <div class="font-semibold">Min: {{ text_stats.min_words }} kata</div>
        </div>
        <div class="text-center">
          <div class="font-semibold">Maks: {{ text_stats.max_words }} kata</div>
        </div>
        <div class="text-center">
          <div class="font-semibold">Median: {{ text_stats.median_words }} kata</div>
        </div>
        <div class="text-center">
          <div class="font-semibold">Std Dev: {{ text_stats.std_words }} kata</div>
        </div>
      </div>
    </div>
    {% endif %}

    <!-- Sentiment Summary -->
    {% if sentiment and sentiment.total > 0 %}
    <div class="mb-8 bg-white rounded-2xl shadow-xl p-8 border border-gray-100">
      <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
        <span class="text-3xl mr-3">ğŸ’­</span>
        Detail Sentimen ({{ sentiment.total }} Respons)
      </h3>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
        <div class="bg-gradient-to-br from-green-50 to-emerald-100 rounded-xl p-6 border-2 border-green-200">
          <div class="text-5xl mb-2">ğŸ˜Š</div>
          <div class="text-3xl font-bold text-green-700">{{ sentiment.summary.positive }}</div>
          <div class="text-sm font-semibold text-green-600">Positif ({{ (sentiment.summary.positive / sentiment.total * 100)|round(1) }}%)</div>
        </div>
        <div class="bg-gradient-to-br from-yellow-50 to-amber-100 rounded-xl p-6 border-2 border-yellow-200">
          <div class="text-5xl mb-2">ğŸ˜</div>
          <div class="text-3xl font-bold text-yellow-700">{{ sentiment.summary.neutral }}</div>
          <div class="text-sm font-semibold text-yellow-600">Netral ({{ (sentiment.summary.neutral / sentiment.total * 100)|round(1) }}%)</div>
        </div>
        <div class="bg-gradient-to-br from-red-50 to-rose-100 rounded-xl p-6 border-2 border-red-200">
          <div class="text-5xl mb-2">ğŸ˜</div>
          <div class="text-3xl font-bold text-red-700">{{ sentiment.summary.negative }}</div>
          <div class="text-sm font-semibold text-red-600">Negatif ({{ (sentiment.summary.negative / sentiment.total * 100)|round(1) }}%)</div>
        </div>
      </div>
    </div>
    {% endif %}

    <!-- Keywords Grid -->
    {% if keywords and keywords.keywords|length > 0 %}
    <div class="mb-8 bg-white rounded-2xl shadow-xl p-8 border border-gray-100">
      <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
        <span class="text-3xl mr-3">ğŸ·ï¸</span>
        Kata Kunci TF-IDF
      </h3>
      <div class="flex flex-wrap gap-3">
        {% for kw in keywords.keywords %}
        <div class="bg-gradient-to-r from-blue-500 to-indigo-600 text-white px-6 py-3 rounded-full shadow-lg flex items-center space-x-3 transform hover:scale-110 transition-all">
          <span class="font-bold text-lg">{{ kw.word }}</span>
          <span class="bg-white bg-opacity-30 px-3 py-1 rounded-full text-xs font-semibold">{{ kw.score|round(2) }}</span>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    <!-- API Access Info -->
    <div class="bg-gradient-to-r from-gray-800 to-gray-900 rounded-2xl shadow-2xl p-8 text-white">
      <h3 class="text-2xl font-bold mb-4 flex items-center">
        <span class="text-3xl mr-3">ğŸ”Œ</span>
        Akses API
      </h3>
      <p class="text-gray-300 mb-4">Data analytics juga tersedia dalam format JSON melalui API endpoint:</p>
      <div class="bg-black bg-opacity-40 rounded-lg p-4 font-mono text-sm border border-gray-700">
        <code class="text-green-400">GET /kuisioner/{{ kuisioner.id }}/analytics</code>
      </div>
      <div class="mt-4 flex space-x-4">
        <a href="/kuisioner/{{ kuisioner.id }}/analytics" target="_blank"
           class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold shadow-lg transition-all flex items-center space-x-2">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
          </svg>
          <span>Lihat JSON Data</span>
        </a>
      </div>
    </div>
  </div>
</div>

<!-- Scroll to Top Button -->
<button onclick="window.scrollTo({top: 0, behavior: 'smooth'})"
        class="fixed bottom-8 right-8 bg-blue-600 hover:bg-blue-700 text-white p-4 rounded-full shadow-2xl transition-all transform hover:scale-110 z-50">
  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
  </svg>
</button>
{% endblock %}
